<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Mi Perfil - ELECTRO SHOP</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

</head>
<body>

<div th:replace="~{fragments/header :: header}"></div>

<main class="container">
    <div class="login-container"> <h1 class="login-title">Mi Perfil</h1>

        <div th:if="${success}" class="alert alert-success" th:text="${success}" style="margin-bottom: 20px;"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}" style="margin-bottom: 20px;"></div>

        <div class="profile-section">
            <h2><i class="fas fa-user-circle"></i> Información Personal</h2>
            <form th:action="@{/perfil/actualizar}" method="POST">
                <div class="form-group">
                    <label for="nombre">Nombre:</label>
                    <input type="text" id="nombre" name="nombre" class="form-control"
                           th:value="${usuario.nombre}"
                           required>
                    <button type="submit" class="btn-sm btn-blue">Guardar Nombre</button>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <label>Email:</label>
                    <p><strong th:text="${usuario.email}"></strong></p>
                </div>
            </form>
        </div>

        <div class="profile-section">
            <h2><i class="fas fa-envelope"></i> Cambiar Correo Electrónico</h2>
            <form th:action="@{/perfil/cambiar-email}" method="POST">
                <div class="form-group">
                    <label for="nuevoEmail">Nuevo Correo Electrónico:</label>
                    <input type="email" id="nuevoEmail" name="nuevoEmail" class="form-control"
                           th:value="${usuario.email}"
                           required>
                    <button type="submit" class="btn-sm btn-blue">Actualizar Email</button>
                    <p class="info-text-small">
                        *Al cambiar tu correo, se cerrará tu sesión por motivos de seguridad. Deberás iniciar sesión con el nuevo email.
                    </p>
                </div>
            </form>
        </div>

        <div class="profile-section">
            <h2><i class="fas fa-credit-card"></i> Métodos de Pago</h2>

            <div style="margin-bottom: 20px;">
                <a th:href="@{/perfil/tarjetas/agregar}" class="btn-primary btn-blue" style="text-decoration: none; display: inline-block; padding: 10px 18px;">
                    + Añadir Nueva Tarjeta
                </a>
            </div>

            <div th:if="${tarjetas.isEmpty()}" class="alert alert-info">
                <p>No tienes tarjetas guardadas.</p>
            </div>

            <div th:unless="${tarjetas.isEmpty()}" class="card-list">
                <div th:each="tarjeta : ${tarjetas}" class="card-item">
                    <i class="fab fa-cc-visa" th:if="${tarjeta.tipo == 'VISA'}" style="color: navy;"></i>
                    <i class="fab fa-cc-mastercard" th:if="${tarjeta.tipo == 'MASTERCARD'}" style="color: darkorange;"></i>
                    <strong th:text="${tarjeta.tipo}"></strong> **** <span th:text="${tarjeta.digitosFinales}"></span>
                    (Vence: <span th:text="${tarjeta.fechaVencimiento}"></span>)
                </div>
            </div>
        </div>

        <div class="register-link" style="margin-top: 30px;">
            <a th:href="@{/}">← Volver al Inicio</a>
        </div>

    </div> </main>

<div th:replace="~{fragments/footer :: footer}"></div>
<script src="/js/main.js"></script>
</body>
</html>